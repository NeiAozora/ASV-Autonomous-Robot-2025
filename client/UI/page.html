<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lintasan A/B Dashboard</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            overflow: hidden;
            background-color: #f3f4f6;
        }
        /* Custom styles for rotated text in sidebar */
        .sidebar-brand-text {
            writing-mode: vertical-rl;
            text-orientation: mixed;
        }
        /* Custom radio button styling */
        input[type="radio"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            display: inline-block;
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 50%;
            border: 2px solid #D1D5DB;
            cursor: pointer;
            outline: none;
            position: relative;
            transition: all 0.2s ease-in-out;
        }
        input[type="radio"]:checked {
            border-color: #EF4444;
        }
        input[type="radio"]:checked::before {
            content: '';
            display: block;
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 50%;
            background-color: #EF4444;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        input[type="radio"].start-radio:checked {
            border-color: #DC2626;
        }
        input[type="radio"].start-radio:checked::before {
            background-color: #DC2626;
        }
        input[type="radio"].finish-radio:checked {
            border-color: #6B7280;
        }
        input[type="radio"].finish-radio:checked::before {
            background-color: #6B7280;
        }
        input[type="radio"].belum-mulai-radio:checked {
            border-color: #F59E0B;
        }
        input[type="radio"].belum-mulai-radio:checked::before {
            background-color: #F59E0B;
        }
        input[type="radio"].perjalanan-radio:checked {
            border-color: #10B981;
        }
        input[type="radio"].perjalanan-radio:checked::before {
            background-color: #10B981;
        }

        /* The container for the entire app layout, which will be scaled */
        #desktop-app-wrapper {
            position: absolute;
            transform-origin: top left;
        }

        /* Active sidebar button style */
        .sidebar-button.active {
            background-color: #ef4444;
            color: #ffffff;
        }

        /* Custom scrollbar styling for the photo entries area */
        #photo-entries-container::-webkit-scrollbar {
            width: 8px;
        }
        #photo-entries-container::-webkit-scrollbar-track {
            background: #e5e7eb;
            border-radius: 4px;
        }
        #photo-entries-container::-webkit-scrollbar-thumb {
            background-color: #ef4444;
            border-radius: 4px;
            border: 2px solid #e5e7eb;
        }
        /* Firefox scrollbar styling */
        #photo-entries-container {
            scrollbar-width: thin;
            scrollbar-color: #ef4444 #e5e7eb;
        }

        /* Custom spinner animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        /* Compass image rotation styling */
        #compass-image-container {
            transform-origin: center center;
            transition: transform 0.3s ease-out;
        }

        /* Restart Confirmation Popup Styling - Fixed positioning */
        #restart-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000; /* Higher z-index to ensure it's on top */
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        #restart-popup-overlay.visible {
            visibility: visible;
            opacity: 1;
        }
        #restart-popup {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            text-align: center;
            max-width: 400px;
            width: 90%;
            z-index: 1001;
        }

        /* Styling untuk video streaming */
        .video-container {
            position: relative;
            background-color: #000;
            overflow: hidden;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .video-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .stream-status {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
            z-index: 10;
        }
        .status-live {
            background-color: #EF4444;
            color: white;
        }
        .status-offline {
            background-color: #6B7280;
            color: white;
        }
        .status-connecting {
            background-color: #F59E0B;
            color: white;
        }
        .video-placeholder {
            color: white;
            text-align: center;
            padding: 1rem;
        }
    </style>
</head>
<body>

    <div id="desktop-app-wrapper">
        <div class="w-[2067px] h-[1024px] relative bg-white overflow-hidden">
            <!-- Main Content Area - This area will contain dynamic content for Dashboard/Daftar Foto -->
            <div id="dashboard-page" class="absolute inset-0">
                <!-- LEFT SIDE: Trajectory Visualisizer -->
                <div class="w-[590px] h-96 left-[261px] top-[75px] absolute bg-zinc-300 rounded-lg flex items-center justify-center text-gray-500 text-xl font-semibold">
                    Trajectory Visualisizer
                </div>
                
                <!-- GPS Data -->
                <div class="w-52 left-[285px] top-[530px] absolute text-black text-3xl font-normal font-['Inter']">GPS</div>
                <div class="left-[237px] top-[578px] absolute text-black text-base font-normal font-['Inter']">Langitude : <span id="gps-latitude">XXXXXXX</span></div>
                <div class="left-[237px] top-[608px] absolute text-black text-base font-normal font-['Inter']">Longitude : <span id="gps-longitude">XXXXXXX</span></div>

                <!-- Battery and Power Information -->
                <div class="w-44 left-[237px] top-[668px] absolute text-center text-black text-2xl font-normal font-['Inter']">Daya Batterai</div>
                <div class="w-44 left-[232px] top-[698px] absolute text-center text-black text-2xl font-normal font-['Inter']"><span id="battery-level">76.7</span>%</div>

                <div class="left-[261px] top-[740px] absolute text-center text-black text-2xl font-normal font-['Inter']">Tegangan </div>
                <div class="left-[301px] top-[771px] absolute text-center text-black text-2xl font-normal font-['Inter']"><span id="voltage">5</span>V</div>

                <div class="left-[291px] top-[815px] absolute text-center text-black text-2xl font-normal font-['Inter']">Arus</div>
                <div class="left-[260px] top-[846px] absolute text-center text-black text-2xl font-normal font-['Inter']"><span id="current">0.34353</span>A</div>

                <!-- SOG and COG Data -->
                <div class="w-44 left-[677px] top-[538px] absolute text-center text-black text-2xl font-normal font-['Inter']">SOG</div>
                <div class="w-44 left-[672px] top-[568px] absolute text-center text-black text-2xl font-normal font-['Inter']"><span id="sog-knots">00</span> Knots</div>
                <div class="w-44 left-[672px] top-[595px] absolute text-center text-black text-2xl font-normal font-['Inter']"><span id="sog-kmh">00</span> Km/h</div>

                <div class="w-44 left-[673px] top-[640px] absolute text-center text-black text-2xl font-normal font-['Inter']">COG</div>
                <div class="w-44 left-[675px] top-[669px] absolute text-center text-black text-2xl font-normal font-['Inter']"><span id="cog-knots">00</span> Knots</div>
                <div class="w-44 left-[674px] top-[698px] absolute text-center text-black text-2xl font-normal font-['Inter']"><span id="cog-kmh">00</span> Km/h</div>

                <!-- Compass and Heading -->
                <div class="left-[492px] top-[794px] absolute text-black text-base font-normal font-['Inter']">Heading : <span id="heading-text">123°</span> </div>
                <div class="w-52 left-[492px] top-[530px] absolute text-black text-3xl font-normal font-['Inter']">Kompas</div>
                
                <!-- Compass Image - now rotatable -->
                <div id="compass-image-container" class="w-52 h-56 left-[437px] top-[577px] absolute flex items-center justify-center">
                    <img id="compass-image" class="w-[217px] h-[217px]" src="Kompas.png" alt="Compass representation" />
                </div>

                <!-- Header and Title -->
                <div id="lintasan-ab-header" class="left-[261px] top-[31px] absolute text-black text-4xl font-normal font-['Inter']">Lintasan A/B</div>
                <div class="left-[421px] top-[247px] absolute text-center text-black text-2xl font-normal font-['Inter']">Trajectory Visualisizer</div>

                <!-- Start and Finish Times -->
                <div class="left-[307px] top-[470px] absolute justify-start"><span class="text-black text-lg font-normal font-['Inter']">Waktu Mulai : </span><span class="text-red-600 text-lg font-normal font-['Inter']">Belum Mulai</span></div>
                <div class="left-[550px] top-[470px] absolute justify-start"><span class="text-black text-lg font-normal font-['Inter']">Waktu Finish : </span><span class="text-red-600 text-lg font-normal font-['Inter']">Belum Sampai</span></div>
                
                <!-- RIGHT SIDE: Images and Live Feeds -->
                <!-- Potret Gambar Atas (Static Image) -->
                <div class="w-96 h-64 left-[1199px] top-[55px] absolute rounded-lg overflow-hidden bg-zinc-300 flex items-center justify-center">
                    <div class="text-center text-gray-600">
                        <i class="fas fa-image text-4xl mb-2"></i>
                        <p>Potret Gambar Atas</p>
                    </div>
                </div>
                <div class="w-56 h-6 left-[1199px] top-[31px] absolute text-black text-xl font-normal font-['Inter']">Potret Gambar Atas</div>
                
                <!-- Peta Arena Lintasan (Trajectory) -->
                <div class="w-[501px] h-80 left-[1142px] top-[684px] absolute bg-zinc-300 rounded-lg flex items-center justify-center">
                    <div class="text-center text-gray-600">
                        <i class="fas fa-map-marked-alt text-4xl mb-2"></i>
                        <p>Peta Arena Lintasan</p>
                    </div>
                </div>
                <div class="w-[539px] h-7 left-[1142px] top-[655px] absolute text-black text-xl font-normal font-['Inter']">Peta Arena Lintasan (Trajectory)</div>
                
                <!-- Potret Gambar Bawah (Static Image) -->
                <div class="w-96 h-64 left-[1199px] top-[353px] absolute rounded-lg overflow-hidden bg-zinc-300 flex items-center justify-center">
                    <div class="text-center text-gray-600">
                        <i class="fas fa-image text-4xl mb-2"></i>
                        <p>Potret Gambar Bawah</p>
                    </div>
                </div>
                <div class="w-60 h-6 left-[1199px] top-[330px] absolute text-black text-xl font-normal font-['Inter']">Potret Gambar Bawah</div>
                
                <!-- RQT Plot -->
                <div class="w-80 h-80 left-[1681px] top-[676px] absolute bg-zinc-300 rounded-lg flex items-center justify-center">
                    <div class="text-center text-gray-600">
                        <i class="fas fa-chart-line text-4xl mb-2"></i>
                        <p>RQT Plot</p>
                    </div>
                </div>
                <div class="w-72 h-8 left-[1681px] top-[647px] absolute text-black text-xl font-normal font-['Inter']">RQT Plot</div>
                
                <!-- Live Foto Bawah -->
                <div class="w-80 h-48 left-[1681px] top-[398px] absolute rounded-lg overflow-hidden video-container">
                    <video id="live-foto-bawah-video" autoplay muted playsinline>
                        Your browser does not support the video tag.
                    </video>
                    <div class="stream-status status-connecting" id="live-foto-bawah-status">
                        <i class="fas fa-circle-notch fa-spin mr-1"></i> Menyambungkan
                    </div>
                    <div class="video-placeholder" id="live-foto-bawah-placeholder">
                        <i class="fas fa-video text-3xl mb-2"></i>
                        <p>Live Foto Bawah</p>
                    </div>
                </div>
                <div class="w-72 h-5 left-[1681px] top-[380px] absolute text-black text-xl font-normal font-['Inter']">Live Foto Bawah</div>
                
                <!-- Live Kamera Bawah -->
                <div class="w-80 h-48 left-[1681px] top-[132px] absolute rounded-lg overflow-hidden video-container">
                    <video id="live-kamera-bawah-video" autoplay muted playsinline>
                        Your browser does not support the video tag.
                    </video>
                    <div class="stream-status status-connecting" id="live-kamera-bawah-status">
                        <i class="fas fa-circle-notch fa-spin mr-1"></i> Menyambungkan
                    </div>
                    <div class="video-placeholder" id="live-kamera-bawah-placeholder">
                        <i class="fas fa-video text-3xl mb-2"></i>
                        <p>Live Kamera Bawah</p>
                    </div>
                </div>
                <div class="w-56 h-5 left-[1681px] top-[115px] absolute text-black text-xl font-normal font-['Inter']">Live Kamera Bawah</div>

                <!-- Mode Lintasan (Trajectory Mode) - Changed to radio buttons with IDs -->
                <div class="left-[926px] top-[99px] absolute text-black text-2xl font-normal font-['Inter']">Mode Lintasan</div>
                <div class="absolute left-[970px] top-[158px] flex flex-col space-y-4">
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="radio" name="trajectory_mode" value="A" id="trajectory-mode-a" class="form-radio" checked>
                        <span class="ml-3 text-black text-2xl font-normal font-['Inter']">A</span>
                    </label>
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="radio" name="trajectory_mode" value="B" id="trajectory-mode-b" class="form-radio">
                        <span class="ml-3 text-black text-2xl font-normal font-['Inter']">B</span>
                    </label>
                </div>


                <!-- MODE: Remote/Autonomous - Added above Keadaan Sekarang -->
                <!-- <div class="left-[970px] top-[275px] absolute text-center text-black text-2xl font-normal font-['Inter']">Mode</div>
                <div class="absolute left-[970px] top-[332px] flex flex-col space-y-4">
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="radio" name="operation_mode" value="Remote" id="operation-mode-remote" class="form-radio remote-radio">
                        <span class="ml-3 text-black text-2xl font-normal font-['Inter']">Remote</span>
                    </label>
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="radio" name="operation_mode" value="Autonomous" id="operation-mode-autonomous" class="form-radio autonomous-radio" checked>
                        <span class="ml-3 text-black text-2xl font-normal font-['Inter']">Autonomous</span>
                    </label>
                </div> -->

                <!-- Keadaan Sekarang (Current State) - Updated radio buttons with IDs -->
                <div class="left-[904px] top-[444px] absolute text-center text-black text-2xl font-normal font-['Inter']">Keadaan Sekarang</div>
                <div class="absolute left-[970px] top-[492px] flex flex-col space-y-4">
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="radio" name="current_state" value="Belum Mulai" id="current-state-belum-mulai" class="form-radio belum-mulai-radio" checked>
                        <span class="ml-3 text-black text-2xl font-normal font-['Inter']">Belum Mulai</span>
                    </label>
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="radio" name="current_state" value="Start" id="current-state-start" class="form-radio start-radio">
                        <span class="ml-3 text-black text-2xl font-normal font-['Inter']">Start</span>
                    </label>
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="radio" name="current_state" value="Perjalanan" id="current-state-perjalanan" class="form-radio perjalanan-radio">
                        <span class="ml-3 text-black text-2xl font-normal font-['Inter']">Perjalanan</span>
                    </label>
                    <label class="inline-flex items-center cursor-pointer">
                        <input type="radio" name="current_state" value="Finish" id="current-state-finish" class="form-radio finish-radio">
                        <span class="ml-3 text-black text-2xl font-normal font-['Inter']">Finish</span>
                    </label>
                </div>
                
                <!-- Restart Button - Changed to an actual button element -->
                <button id="restart-btn" class="w-36 h-14 left-[927px] top-[781px] absolute bg-blue-600 text-white rounded-[20px] flex items-center justify-center text-2xl font-bold hover:bg-blue-700 transition-colors">
                    <i class="fas fa-redo-alt mr-2"></i> Restart
                </button>

                <!-- Refresh Data Button -->
                <button id="refresh-data-btn" class="w-44 h-14 left-[927px] top-[850px] absolute bg-green-600 text-white rounded-[20px] flex items-center justify-center text-xl font-bold hover:bg-green-700 transition-colors">
                    <i class="fas fa-sync-alt mr-2"></i> Refresh Data
                </button>

                <!-- Mulai Button -->
                <button id="mulai-btn" class="w-36 h-14 left-[927px] top-[920px] absolute bg-purple-600 text-white rounded-[20px] flex items-center justify-center text-2xl font-bold hover:bg-purple-700 transition-colors">
                    <i class="fas fa-play mr-2"></i> Mulai
                </button>
                
                <!-- Footer Logs -->
                <div class="left-[185px] top-[957px] absolute text-black text-lg font-normal font-['Inter']">Log Kamera Atas     : <span id="log-kamera-atas">TipeLintasan_Atas_Hijau_Time.jpg</span></div>
                <div class="left-[185px] top-[986px] absolute text-black text-lg font-normal font-['Inter']">Log Kamera Bawah : <span id="log-kamera-bawah">Menuggu....</span></div>
            </div>

            <div id="daftar-foto-page" class="absolute inset-0 hidden">
                <!-- Daftar Foto Title -->
                <div class="absolute left-[261px] top-[31px] text-black text-4xl font-normal font-['Inter']">Daftar Foto</div>

                <!-- Photo Entries Container (with functional scrollbar) -->
                <div id="photo-entries-container" class="absolute left-[261px] top-[100px] w-[800px] h-[850px] overflow-y-auto pr-4"> 
                    <!-- First Image Entry -->
                    <div class="w-full bg-white rounded-lg p-6 shadow-lg flex items-center mb-8">
                        <div class="flex-1">
                            <p class="text-black text-2xl font-normal font-['Inter'] mb-2"><span class="font-bold">Nama :</span> TipeLintasan_Atas_Hijau_Time.jpg</p>
                            <p class="text-black text-2xl font-normal font-['Inter'] mb-2"><span class="font-bold">Waktu :</span> 13:45</p>
                            <p class="text-black text-2xl font-normal font-['Inter'] mb-4"><span class="font-bold">Tanggal :</span> 15 Januari 2025</p>
                            <button class="bg-blue-600 text-white py-2 px-6 rounded-lg font-bold hover:bg-blue-700 transition-colors">Download</button>
                        </div>
                        <div class="w-64 h-48 bg-gray-300 rounded-lg flex-shrink-0 ml-8"></div> <!-- Image Placeholder -->
                    </div>

                    <!-- Second Image Entry -->
                    <div class="w-full bg-white rounded-lg p-6 shadow-lg flex items-center mb-8">
                        <div class="flex-1">
                            <p class="text-black text-2xl font-normal font-['Inter'] mb-2"><span class="font-bold">Nama :</span> TipeLintasan_Bawah_Hijau_Time.jpg</p>
                            <p class="text-black text-2xl font-normal font-['Inter'] mb-2"><span class="font-bold">Waktu :</span> 13:45</p>
                            <p class="text-black text-2xl font-normal font-['Inter'] mb-4"><span class="font-bold">Tanggal :</span> 15 Januari 2025</p>
                            <button class="bg-blue-600 text-white py-2 px-6 rounded-lg font-bold hover:bg-blue-700 transition-colors">Download</button>
                        </div>
                        <div class="w-64 h-48 bg-gray-300 rounded-lg flex-shrink-0 ml-8"></div> <!-- Image Placeholder -->
                    </div>

                    <!-- Additional entries to make the scrollbar appear and be functional -->
                    <div class="w-full bg-white rounded-lg p-6 shadow-lg flex items-center mb-8">
                        <div class="flex-1">
                            <p class="text-black text-2xl font-normal font-['Inter'] mb-2"><span class="font-bold">Nama :</span> TipeLintasan_Ketiga_Time.jpg</p>
                            <p class="text-black text-2xl font-normal font-['Inter'] mb-2"><span class="font-bold">Waktu :</span> 14:00</p>
                            <p class="text-black text-2xl font-normal font-['Inter'] mb-4"><span class="font-bold">Tanggal :</span> 15 Januari 2025</p>
                            <button class="bg-blue-600 text-white py-2 px-6 rounded-lg font-bold hover:bg-blue-700 transition-colors">Download</button>
                        </div>
                        <div class="w-64 h-48 bg-gray-300 rounded-lg flex-shrink-0 ml-8"></div> <!-- Image Placeholder -->
                    </div>
                    <div class="w-full bg-white rounded-lg p-6 shadow-lg flex items-center mb-8">
                        <div class="flex-1">
                            <p class="text-black text-2xl font-normal font-['Inter'] mb-2"><span class="font-bold">Nama :</span> TipeLintasan_Keempat_Time.jpg</p>
                            <p class="text-black text-2xl font-normal font-['Inter'] mb-2"><span class="font-bold">Waktu :</span> 14:15</p>
                            <p class="text-black text-2xl font-normal font-['Inter'] mb-4"><span class="font-bold">Tanggal :</span> 15 Januari 2025</p>
                            <button class="bg-blue-600 text-white py-2 px-6 rounded-lg font-bold hover:bg-blue-700 transition-colors">Download</button>
                        </div>
                        <div class="w-64 h-48 bg-gray-300 rounded-lg flex-shrink-0 ml-8"></div> <!-- Image Placeholder -->
                    </div>
                </div>

                <!-- Removed the aesthetic scrollbar div -->
            </div>

            <!-- Sidebar - Aesthetic changes remain -->
            <div class="w-36 h-[1024px] left-0 top-0 absolute bg-gray-800 rounded-lg p-4 flex flex-col justify-between shadow-lg text-white">
                <div>
                    <!-- Logo Section -->
                    <div class="w-20 h-20 mx-auto mt-8 mb-4 bg-red-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-ship text-3xl"></i>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="space-y-4">
                        <button id="dashboard-btn" class="sidebar-button w-full py-3 px-2 bg-red-500 rounded-lg flex flex-col items-center justify-center font-medium shadow-sm hover:bg-red-400 transition-colors active">
                            <i class="fas fa-chart-line text-xl mb-1"></i> Dashboard
                        </button>
                        <button id="daftar-foto-btn" class="sidebar-button w-full py-3 px-2 bg-red-500 rounded-lg flex flex-col items-center justify-center font-medium shadow-sm hover:bg-red-400 transition-colors">
                            <i class="fas fa-camera-retro text-xl mb-1"></i> Daftar foto
                        </button>
                    </div>
                </div>

                <!-- Vertical Brand Text -->
                <div class="relative w-full h-1/3">
                    <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 transform origin-center text-xl font-bold text-gray-400 opacity-75 whitespace-nowrap">
                        <!-- DO NOT ADD, THIS IS SVG ONLY -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Popup kecil di pojok kanan bawah -->
    <div id="loading-popup" class="absolute bottom-4 right-4 bg-blue-600 text-white p-4 rounded-lg shadow-xl flex items-center space-x-3 z-50 pointer-events-none">
        <div class="spinner"></div>
        <span>Berusaha Menyambung Ke Server....</span>
    </div>

    <!-- Restart Confirmation Popup - Moved outside the scaled wrapper -->
    <div id="restart-popup-overlay">
        <div id="restart-popup">
            <p class="text-xl font-semibold text-gray-800 mb-6" id="restart-popup-message">
                Apakah anda yakin ingin memulai dari awal di mode lintasan {mode_lintasan_placeholder}?
            </p>
            <div class="flex justify-center space-x-4">
                <button id="restart-confirm-yes" class="bg-red-600 text-white py-2 px-6 rounded-lg font-bold hover:bg-red-700 transition-colors">Ya</button>
                <button id="restart-confirm-no" class="bg-gray-300 text-gray-800 py-2 px-6 rounded-lg font-bold hover:bg-gray-400 transition-colors">Tidak</button>
            </div>
        </div>
    </div>

    <script>
/**
 * SCRIPT: Integrasi server (fetch) — TANPA MENGUBAH CSS / SIZING
 * Salin-tempel ganti <script> lama Anda dengan skrip ini.
 * Pastikan API_BASE sesuai server (default: http://localhost:8000/api).
 */

/* === CONFIG === */
const API_BASE = "http://localhost:8000/api";
const DASHBOARD_POLL_MS = 300;



/* === PING / LOADING POPUP LOGIC (tambah ke JS existing) === */
const PING_INTERVAL_MS = 3000;   // ping setiap 3 detik
const PING_TIMEOUT_MS = 1500;    // timeout tiap ping (1.5s) - sesuaikan jika perlu

let _pingIntervalId = null;
let _isLoadingPopupVisible = false;

/**
 * Show/hide loading popup safely without touching external CSS rules.
 * Menggunakan inline style display untuk tidak merusak stylesheet.
 */
function setLoadingPopupVisible(visible) {
    const el = document.getElementById('loading-popup');
    if (!el) return;
    if (visible) {
        // gunakan flex sesuai struktur HTML (popup awal bergaya flex)
        el.style.display = 'flex';
        // pointer-events tetap sesuai kelas (pointer-events-none) — jika diperlukan enable, ubah class tambahan.
    } else {
        el.style.display = 'none';
    }
    _isLoadingPopupVisible = !!visible;
}

/**
 * Lakukan satu kali ping ke server.
 * Menggunakan fetchJson helper yang sudah ada (memiliki timeout argumen).
 * Returns boolean: true = reachable, false = not reachable
 */
async function pingServerOnce() {
    try {
        // gunakan endpoint ping ringan
        const resp = await fetchJson(`${API_BASE}/ping`, {}, PING_TIMEOUT_MS);
        // jika response valid dan status ok => server reachable
        if (resp && resp.status === 'ok') {
            return true;
        }
        // fallback: jika resp ada tetapi bukan status ok, treat as failure
        return false;
    } catch (err) {
        // fetch error / timeout / network down
        return false;
    }
}

/**
 * Start continuous ping loop. Menampilkan popup jika gagal.
 * Idempotent: memeriksa _pingIntervalId untuk menghindari multiple intervals.
 */
function startPingLoop() {
    if (_pingIntervalId) return; // sudah jalan
    // pastikan popup tersembunyi saat mulai (tidak merusak CSS)
    setLoadingPopupVisible(false);

    // lakukan ping segera sekali lalu interval
    (async () => {
        const ok = await pingServerOnce();
        setLoadingPopupVisible(!ok);
    })();

    _pingIntervalId = setInterval(async () => {
        const ok = await pingServerOnce();
        // jika gagal => tampilkan popup; jika berhasil => sembunyikan popup
        if (!ok && !_isLoadingPopupVisible) {
            setLoadingPopupVisible(true);
        } else if (ok && _isLoadingPopupVisible) {
            setLoadingPopupVisible(false);
        }
    }, PING_INTERVAL_MS);
}

/**
 * Stop ping loop (dipanggil saat unload jika ingin bersih)
 */
function stopPingLoop() {
    if (_pingIntervalId) {
        clearInterval(_pingIntervalId);
        _pingIntervalId = null;
    }
}



/* === scaleContent: KEMBALIKAN PERSIS seperti asli (tidak merusak sizing) === */
function scaleContent() {
    const wrapper = document.getElementById('desktop-app-wrapper');
    const appWidth = 2067; // Updated width
    const appHeight = 1024; // Tinggi desain asli (piksel)

    const viewportWidth = window.innerWidth;
    const viewportHeight = window.innerHeight;

    // Hitung faktor skala yang dibutuhkan untuk lebar dan tinggi
    const scaleX = viewportWidth / appWidth;
    const scaleY = viewportHeight / appHeight;

    // Gunakan skala terkecil untuk memastikan seluruh konten pas di viewport
    // tanpa menyebabkan scroll, sambil mempertahankan rasio aspek.
    const scale = Math.min(scaleX, scaleY);

    // Terapkan transformasi skala
    wrapper.style.transform = `scale(${scale})`;
    wrapper.style.transformOrigin = `top left`; // Skala dari sudut kiri atas

    // Hitung tinggi yang diskalakan untuk pemosisian vertikal
    const scaledHeight = appHeight * scale;

    // Posisi X: Selalu lengket ke kiri (0px dari tepi viewport)
    const offsetX = 0;
    // Posisi Y: Pusatkan secara vertikal
    const offsetY = (viewportHeight - scaledHeight) / 2;

    // Terapkan posisi absolut
    wrapper.style.left = `${offsetX}px`;
    wrapper.style.top = `${offsetY}px`;

    // Loading popup tetap fixed; tidak diubah di sini
}

/* === helper fetch dengan timeout === */
async function fetchJson(url, opts = {}, timeoutMs = 5000) {
    const controller = new AbortController();
    const id = setTimeout(() => controller.abort(), timeoutMs);
    try {
        const res = await fetch(url, { signal: controller.signal, ...opts });
        clearTimeout(id);
        if (!res.ok) {
            const text = await res.text().catch(() => "");
            throw new Error(`HTTP ${res.status} ${res.statusText} ${text}`);
        }
        return await res.json();
    } catch (err) {
        clearTimeout(id);
        throw err;
    }
}

/* === SPA navigation (ASLI) === */
function showPage(pageId) {
    const pages = ['dashboard-page', 'daftar-foto-page'];
    pages.forEach(id => {
        const page = document.getElementById(id);
        if (page) page.classList.add('hidden');
    });

    const activePage = document.getElementById(pageId);
    if (activePage) activePage.classList.remove('hidden');

    // Update active state for sidebar buttons
    const buttons = document.querySelectorAll('.sidebar-button');
    buttons.forEach(button => {
        button.classList.remove('active');
        if (button.id === `${pageId.replace('-page', '')}-btn`) {
            button.classList.add('active');
        }
    });
}

/* === Ambil data dashboard dari server dan update DOM === */
async function fetchDashboardData() {
    try {
        const data = await fetchJson(`${API_BASE}/dashboard`);
        if (!data) return;

        // GPS
        document.getElementById('gps-latitude').textContent = data.gps_latitude ?? "XXXXXXX";
        document.getElementById('gps-longitude').textContent = data.gps_longitude ?? "XXXXXXX";

        // Power
        document.getElementById('battery-level').textContent = data.battery_level ?? "0.0";
        document.getElementById('voltage').textContent = data.voltage ?? "0";
        document.getElementById('current').textContent = data.current ?? "0.00000";

        // SOG/COG
        document.getElementById('sog-knots').textContent = data.sog_knots ?? "00";
        document.getElementById('sog-kmh').textContent = data.sog_kmh ?? "00";
        document.getElementById('cog-knots').textContent = data.cog_knots ?? "00";
        document.getElementById('cog-kmh').textContent = data.cog_kmh ?? "00";

        // Heading + compass rotation (tidak menyentuh wrapper transform)
        document.getElementById('heading-text').textContent = `${data.heading ?? 0}°`;
        const compassImageContainer = document.getElementById('compass-image-container');
        if (compassImageContainer && typeof data.heading !== 'undefined') {
            // Set transform to rotate only — safe karena parent (wrapper) sudah diskalakan secara terpisah.
            compassImageContainer.style.transform = `rotate(${data.heading}deg)`;
        }

        // Logs
        document.getElementById('log-kamera-atas').textContent = data.log_kamera_atas ?? "-";
        document.getElementById('log-kamera-bawah').textContent = data.log_kamera_bawah ?? "-";

        // Trajectory mode radios (A/B)
        if (data.trajectory_mode) {
            const tm = data.trajectory_mode.toString().toLowerCase();
            const el = document.getElementById(`trajectory-mode-${tm}`);
            if (el) el.checked = true;
            document.getElementById('lintasan-ab-header').textContent = `Lintasan ${data.trajectory_mode}`;
        }

        // Current state radios
        if (data.current_state) {
            document.querySelectorAll('input[name="current_state"]').forEach(r => r.checked = false);
            const stateId = `current-state-${data.current_state.toString().toLowerCase().replace(/\s+/g, '-')}`;
            const stateRadio = document.getElementById(stateId);
            if (stateRadio) stateRadio.checked = true;
        }

    } catch (err) {
        console.error("fetchDashboardData error:", err);
        // jangan merusak UI sizing; tampilkan fallback teks singkat (DOM tetap utuh)
        // contoh fallback pada elemen tertentu (opsional)
        // document.getElementById('log-kamera-bawah').textContent = "Error connecting";
    }
}

/* === Ambil daftar foto dari server dan render (Daftar Foto) === */
async function fetchPhotoList() {
    try {
        const resp = await fetchJson(`${API_BASE}/photos`);
        const container = document.getElementById('photo-entries-container');
        if (!container) return;
        container.innerHTML = ""; // clear existing entries but preserve container sizing/styles

        const photos = resp.photos || [];
        photos.forEach(p => {
            const entry = document.createElement('div');
            entry.className = "w-full bg-white rounded-lg p-6 shadow-lg flex items-center mb-8";
            entry.innerHTML = `
                <div class="flex-1">
                    <p class="text-black text-2xl font-normal font-['Inter'] mb-2"><span class="font-bold">Nama :</span> ${p.name}</p>
                    <p class="text-black text-2xl font-normal font-['Inter'] mb-2"><span class="font-bold">Waktu :</span> ${p.time}</p>
                    <p class="text-black text-2xl font-normal font-['Inter'] mb-4"><span class="font-bold">Tanggal :</span> ${p.date}</p>
                    <a class="bg-blue-600 text-white py-2 px-6 rounded-lg font-bold hover:bg-blue-700 transition-colors" href="${p.download_url}" target="_blank" rel="noopener">Download</a>
                </div>
                <div class="w-64 h-48 bg-gray-300 rounded-lg flex-shrink-0 ml-8"></div>
            `;
            container.appendChild(entry);
        });
    } catch (err) {
        console.error("fetchPhotoList error:", err);
    }
}

/* === Ambil URL video dari server dan attach ke elemen <video> (tidak modifikasi CSS) === */
async function setupVideoStreams() {
    try {
        const urls = await fetchJson(`${API_BASE}/video_urls`);
        if (!urls) return;

        const liveFotoBawahVideo = document.getElementById('live-foto-bawah-video');
        const liveKameraBawahVideo = document.getElementById('live-kamera-bawah-video');
        const liveFotoBawahStatus = document.getElementById('live-foto-bawah-status');
        const liveKameraBawahStatus = document.getElementById('live-kamera-bawah-status');
        const liveFotoBawahPlaceholder = document.getElementById('live-foto-bawah-placeholder');
        const liveKameraBawahPlaceholder = document.getElementById('live-kamera-bawah-placeholder');

        if (urls.live_foto_bawah && liveFotoBawahVideo) {
            liveFotoBawahVideo.src = urls.live_foto_bawah;
            liveFotoBawahVideo.loop = true;
            liveFotoBawahVideo.muted = true; // mute to increase autoplay success chance
            liveFotoBawahVideo.play().then(() => {
                if (liveFotoBawahStatus) {
                    liveFotoBawahStatus.className = 'stream-status status-live';
                    liveFotoBawahStatus.innerHTML = '<i class="fas fa-circle mr-1"></i> LIVE';
                }
                if (liveFotoBawahPlaceholder) liveFotoBawahPlaceholder.style.display = 'none';
            }).catch(e => {
                if (liveFotoBawahStatus) {
                    liveFotoBawahStatus.className = 'stream-status status-offline';
                    liveFotoBawahStatus.innerHTML = '<i class="fas fa-exclamation-triangle mr-1"></i> Offline';
                }
                if (liveFotoBawahPlaceholder) liveFotoBawahPlaceholder.style.display = 'flex';
                console.debug("liveFotoBawahVideo play error:", e);
            });
        }

        if (urls.live_kamera_bawah && liveKameraBawahVideo) {
            liveKameraBawahVideo.src = urls.live_kamera_bawah;
            liveKameraBawahVideo.loop = true;
            liveKameraBawahVideo.muted = true;
            liveKameraBawahVideo.play().then(() => {
                if (liveKameraBawahStatus) {
                    liveKameraBawahStatus.className = 'stream-status status-live';
                    liveKameraBawahStatus.innerHTML = '<i class="fas fa-circle mr-1"></i> LIVE';
                }
                if (liveKameraBawahPlaceholder) liveKameraBawahPlaceholder.style.display = 'none';
            }).catch(e => {
                if (liveKameraBawahStatus) {
                    liveKameraBawahStatus.className = 'stream-status status-offline';
                    liveKameraBawahStatus.innerHTML = '<i class="fas fa-exclamation-triangle mr-1"></i> Offline';
                }
                if (liveKameraBawahPlaceholder) liveKameraBawahPlaceholder.style.display = 'flex';
                console.debug("liveKameraBawahVideo play error:", e);
            });
        }

    } catch (err) {
        console.error("setupVideoStreams error:", err);
    }
}

/* === Restart API call === */
async function apiRestart() {
    try {
        const selectedMode = document.querySelector('input[name="trajectory_mode"]:checked')?.value || null;
        await fetchJson(`${API_BASE}/restart`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ mode: selectedMode })
        }, 7000);
        // After restart, refresh dashboard once
        await fetchDashboardData();
    } catch (err) {
        console.error("apiRestart error:", err);
    }
}

/* === Event wiring: gunakan handlers asli, hanya mengganti fungsi data dengan fetch-based === */
document.addEventListener('DOMContentLoaded', () => {
    // Sidebar buttons
    const dashboardBtn = document.getElementById('dashboard-btn');
    const daftarFotoBtn = document.getElementById('daftar-foto-btn');
    if (dashboardBtn) dashboardBtn.addEventListener('click', () => {
        showPage('dashboard-page');
    });
    if (daftarFotoBtn) daftarFotoBtn.addEventListener('click', () => {
        showPage('daftar-foto-page');
        fetchPhotoList();
    });

    // Buttons
    const refreshBtn = document.getElementById('refresh-data-btn');
    if (refreshBtn) refreshBtn.addEventListener('click', fetchDashboardData);

    const mulaiBtn = document.getElementById('mulai-btn');
    if (mulaiBtn) mulaiBtn.addEventListener('click', () => console.log("Tombol Mulai diklik!"));

    // Restart popup wiring
    const restartBtn = document.getElementById('restart-btn');
    const restartConfirmYes = document.getElementById('restart-confirm-yes');
    const restartConfirmNo = document.getElementById('restart-confirm-no');
    if (restartBtn) {
        restartBtn.addEventListener('click', () => {
            const popupMessage = document.getElementById('restart-popup-message');
            const selectedMode = document.querySelector('input[name="trajectory_mode"]:checked')?.value || 'A';
            if (popupMessage) popupMessage.textContent = `Apakah anda yakin ingin memulai dari awal di mode lintasan ${selectedMode}?`;
            document.getElementById('restart-popup-overlay')?.classList.add('visible');
        });
    }
    if (restartConfirmYes) {
        restartConfirmYes.addEventListener('click', async () => {
            await apiRestart();
            document.getElementById('restart-popup-overlay')?.classList.remove('visible');
        });
    }
    if (restartConfirmNo) {
        restartConfirmNo.addEventListener('click', () => {
            document.getElementById('restart-popup-overlay')?.classList.remove('visible');
        });
    }

    // Trajectory radio update header (ASLI)
    document.querySelectorAll('input[name="trajectory_mode"]').forEach(radio => {
        radio.addEventListener('change', function() {
            document.getElementById('lintasan-ab-header').textContent = `Lintasan ${this.value}`;
        });
    });


    startPingLoop();

    // Initial actions (preserve layout scaling behavior)
    showPage('dashboard-page');
    fetchDashboardData();
    setupVideoStreams();
    // Polling dashboard
    setInterval(fetchDashboardData, DASHBOARD_POLL_MS);
});

/* === Keep scaleContent listeners === */
window.addEventListener('resize', scaleContent);
window.addEventListener('load', scaleContent);
/* apply once immediately (original behaviour) */
scaleContent();
    </script>
</body>
</html>